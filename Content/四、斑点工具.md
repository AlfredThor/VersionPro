# 斑点工具

### 学习目标
- 识别斑点工具是解决视觉方案的一部分
- 创建并且配置一个斑点工具
    - 在指定的灰度范围内查找斑点
    - 根据给定的标准筛选斑点
---
### 概述
- 斑点分析探测并且分析图像中的二维形状
- 斑点通过辨别处于用户定义的灰度范围内的不同的像素组来查找对象
- 斑点报告多重共属性：
    - 面积
    - 质心
    - 周长
    - 主轴
    
### 何时使用斑点
- 斑点分析非常适合一下场合使用：
    - 对象在尺寸、形状或方向上差异很大（训练模型很难或者不可能）
    - 对象有背景中找不到的截然不同的回读
    - 对象没有重叠或者接触
- 应用案例：
    - 检查环氧树脂点分配的数量、尺寸和形状
    - 检查表示坏薄片模型的莫水电的正确位置和大小
    - 检查药片的破碎和大小
    - 根据对象的尺寸、形状或位置整理或分类对象  
[图片](https://github.com/Hellathor/VersionPro/blob/main/img/20220316143450.jpg)
### 分割
- 斑点在其运行时所做的第一件事就是图像分割，确定哪些像素是斑点像素以及哪些是背景像素
- 有数种模式可以指定哪些可以将斑点与背景像素分开
- 多数模式会要求：
    - 极性
        - 在光亮背景上的黑色、斑点
        - 在黑色背景上的光亮斑点
    - 阀值
        - 将斑点像素从背景像素中分开来的值
- 固定阀值
    - 在固定阀值中，斑点像素和背景像素分别根据灰度值来确定
    - 确定一个灰度值阀值
- 相对阀值
    - 相对阀值解释为左尾和右尾之间全体像素的百分点
    - 尾度代表柱状图两端的噪音像素  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316155149.png)
- 使用相对阀值
    - 相对阀值调整因为线性灯光变化  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316155327.png)
- 固定和相对阀值
    - 固定的灰度阀值不提供线性灯光变化  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316155457.png)
    - 固定的阀值要比相对的速度**快**，因为与百分比对应灰度不必计算
    - 固定阀值可以检测场景中是否有某特征，而相对阀值始终在场景中找到一个半点  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316155728.png)
- 硬性阀值
    - 到目前为止所有例子都是用了硬性阀值
        - 该值（灰度或百分比）将斑点像素从背景像素中分开  
        [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316155948.png)
    - 阀值动态地选择，对于灰度双峰分布的图像有益  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316160223.png)
    - 规定单个百分数和尾度  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316160334.png)
    - 规定单个灰度值  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316160412.png)
- 空间量化错误
    - 当对象在不同图像降落在不同的像素格子上时，硬性阀值同时重现
    - 可能导致斑点尺寸、周长、位置的错误结果
    - 随着对象周长加长，错误变得更加明显
- 像素加权
    - 空间量化错误可以通过应用像素加权来消除
    - 当斑点对应于像素格子移动时，总权数保持不变
- 软性阀值
    - 使用软性阀值创建一个像素加权计划
    - 软性阀值使用一系列阀值  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316161038.png)
- 软性阀值例子
    - 低阀值 = 50
    - 高阀值 = 65
    - 软度 = 3  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316161209.png)
    - 阀值使用灰度表示  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316161353.png)
    - 阀值和尾度使用百分数表示  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316161448.png)
### 使用一个减法图像
- 当图像包含类似的背景和斑点灰度时，使用一个减法图像
- 阀值图像只包含背景信息
- 图像中的每个像素与阀值图像中的相应像素相差指定的数量，即斑点像素
### 像素映射
- 为不能使用硬性或者软性二进制阀值进行分割的图像使用一个像素映射（查找表）
- 要求一个比例因子，应用到像素映射值  
[img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316162243.png)
- 为每个灰度提供一个输出值  
[img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316162537.png)
### 连通性分析
- 在将图像分区之后，斑点执行连通性分析
- 整个图像斑点分析返回图像中所有斑点像素的一个结果
- 灰度分析辨别离散的已连接斑点
### 已连接斑点分析
- 对象像素必须
    - 垂直、横向或者对角相连
- 背景像素只是
    - 垂直或者横向的连接
### 应用形态筛选
- 首先从下拉列表中选择筛选方式
- 顺序问题
    - 要重新排序或者删除某操作，使用对话框中的按钮
### 修剪和填充
- 修剪忽略但是不删除低于规定尺寸的特征
- 填充使用灰度值从左边相邻的像素开始填充修剪后的特征  
[img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316163637.png)
### 区域
- 在默认状态下，斑点分析在整个图像上进行
- 要只在采集的图像的一个部分中探测斑点。需要使用一个区域形状
    - 可能在输入图像上图形定位和设定大小
### 测量
- 允许你指定在每个斑点上计算的测量
- 对于每种所选的测量，选择：
    - 网格
    - 运行期间
    - 筛选
- 针对任何属性，使用筛选来排除一定范围之外的斑点
    - 或者只包括在一定范围之内的
### 测量
- 结果可以按顺序整理，以便进行所选择的测量：升序或者降序
### 图形
- 选择，以便新世界过或诊断图形
    - 记住图形会增加时间  
    [img](https://github.com/Hellathor/VersionPro/blob/main/img/20220316165038.png)
### 结果
- N
    - 索引的斑点
- ID
    - 处于分类标准外的独特的斑点标识符
- 测量
    - 为所选择的那些测量进行
### 几何属性
- 几何属性为常量的斑点测量，不论斑点的方向
    - 面积
    - 周长
    - 质心
    - 坐标轴周围惯量的第三个力矩
    - 几何延伸
    - 主要限制框
### 拓扑的属性
- 辨别斑点、孔以及孔中的斑点